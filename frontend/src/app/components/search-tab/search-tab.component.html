<!-- Header with search -->
<header class="search-header">
  <div class="search-bar">
    <mat-form-field appearance="outline" class="search-input">
      <mat-icon matPrefix class="search-icon">search</mat-icon>
      <input
        matInput
        type="text"
        placeholder="Поиск табаков..."
        [value]="searchQuery()"
        (input)="onSearchInput($event.target.value)"
      />
    </mat-form-field>
    <button
      mat-icon-button
      class="filter-button"
      (click)="onFilterClick()"
      [disabled]="loadingFilters()"
    >
      <mat-icon>tune</mat-icon>
      @if (hasActiveFilters()) {
        <span class="filter-indicator"></span>
      }
    </button>
  </div>
</header>

<!-- Main content -->
<main class="main-content" (scroll)="onLoadMore()">
  <!-- Loading state - Skeleton cards -->
  @if (loading() && tobaccos().length === 0) {
    <div class="skeleton-list">
      @for (i of [1, 2, 3, 4, 5]; track i) {
        <app-skeleton-card />
      }
    </div>
  }

  <!-- Error state -->
  @if (error() && !loading()) {
    <div class="error-container">
      <p class="error-text">{{ error() }}</p>
      <button mat-button (click)="loadTobaccos()">Попробовать снова</button>
    </div>
  }

  <!-- Empty state -->
  @if (!loading() && !error() && tobaccos().length === 0) {
    <div class="empty-container">
      <p class="empty-text">Ничего не найдено</p>
    </div>
  }

  <!-- Tobacco cards list -->
  @if (!loading() && tobaccos().length > 0) {
    <div class="tobaccos-list">
      @for (tobacco of tobaccos(); track tobacco.id) {
        <app-tobacco-card
          [tobacco]="tobacco"
          [brandName]="tobacco.brand?.name ?? null"
          [lineName]="tobacco.line?.name ?? null"
          [adding]="addingToWishlist().has(tobacco.id)"
          [removing]="removingFromWishlist().has(tobacco.id)"
          [withCheckmark]="itemsWithCheckmark().has(tobacco.id)"
          [inWishlist]="wishlistTobaccoIds().has(tobacco.id)"
          (cardClick)="onCardClick($event)"
          (addToWishlist)="onAddToWishlist($event)"
          (removeFromWishlist)="onRemoveFromWishlist($event)"
        />
      }
    </div>
  }

  <!-- Loading more indicator -->
  @if (loading() && tobaccos().length > 0) {
    <div class="loading-more">
      <mat-spinner diameter="30"></mat-spinner>
    </div>
  }

  <!-- No more items indicator -->
  @if (!loading() && !hasMore() && tobaccos().length > 0) {
    <div class="end-message">
      <p>Показаны все результаты</p>
    </div>
  }
</main>

  <!-- Filter Modal -->
  <app-filter-modal
    [open]="showFilterModal()"
    [selectedStatus]="selectedStatus()"
    [selectedCountry]="selectedCountry()"
    [availableStatuses]="availableStatuses()"
    [availableCountries]="availableCountries()"
    [hasActiveFilters]="hasActiveFilters()"
    (close)="onFilterModalClose()"
    (statusChange)="onStatusChange($event)"
    (countryChange)="onCountryChange($event)"
    (resetFilters)="onResetFilters()"
  />

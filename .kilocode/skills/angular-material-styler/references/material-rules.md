# Краткая внутренняя справка по токенам, темам и кастомизации Angular Material

## 1. Что такое токены и зачем они нужны

Токены — это по сути «именованные значения» для цветов, отступов, скруглений, теней, типографики и т.п. Они:

- задают единый дизайн-язык приложения;
- позволяют менять тему (light/dark, бренд, плотность) в одном месте;
- отделяют «что мы хотим видеть» от конкретных значений (4px, #123abc).

Angular Material использует несколько уровней токенов, но для нас главное:

- системные токены (system tokens) — CSS‑переменные вида `--mat-sys-*` (цвета, скругления, тени, шрифты и т.д.), создаются через `mat.theme()`;
- компонентные токены — настройки конкретных компонентов (цвет кнопки, высота прогресс‑бара, форма диалога и т.п.). Для каждого компонента есть свой `*-overrides`‑миксин, который принимает карту этих токенов; компонентные токены часто по умолчанию ссылаются на системные (колонка “Based on system token” в таблице токенов).

**Пример системных токенов:**

```css
background-color: var(--mat-sys-surface);
color: var(--mat-sys-on-surface);
border: 1px solid var(--mat-sys-outline-variant);
border-radius: var(--mat-sys-corner-small);
```

**Пример компонентных токенов (через overrides):**

```scss
@use '@angular/material' as mat;

.my-feature-dialog mat-dialog-container {
  @include mat.dialog-overrides((
    container-shape: 16px,
    container-background-color: var(--mat-sys-surface-container-low),
  ));
}
```

## 2. Когда использовать `*-overrides` внутри своих компонентов в фичах

Overrides — основной и официальный способ менять вид конкретного Material‑компонента, не ломаясь при обновлениях. Angular официально не поддерживает прямое переопределение CSS компонентов вне theming API, потому что DOM и классы — приватная реализация и могут меняться.

Используй `*-overrides` внутри фичи, когда:

- нужно поменять конкретный Material‑компонент только в одном месте (внутри одной фичи/компонента);
- это не глобальная смена темы, а «особый» дизайн именно этого экрана/модуля;
- изменения касаются цветов, форм, размеров, отступов, состояний, которые представлены токенами.

**Пример: кастомный прогресс‑бар внутри карточки одной фичи**

```scss
@use '@angular/material' as mat;

.upload-card {
  padding: 16px;
  border-radius: var(--mat-sys-corner-medium);
  background: var(--mat-sys-surface-container-low);
}

.upload-card mat-progress-bar {
  @include mat.progress-bar-overrides((
      track-color: var(--mat-sys-surface-container-highest),
      active-indicator-color: var(--mat-sys-primary),
      track-shape: 4px,
  ));
}
```

Здесь:

- `upload-card` — свои стили твоего компонента;
- `mat-progress-bar-overrides` — только для `mat-progress-bar` внутри этого класса.

## 3. Когда лучше использовать переопределение темы внутри своих компонентов в фичах

«Переопределение темы» — это новый вызов `mat.theme()` (или дополнительная конфигурация) под определённым селектором, чтобы сменить системные токены в этой зоне.

Используй scoped‑тему, когда:

- целой области/модулю нужны свои цвета / плотность / типографика, и это влияет сразу на много компонентов;
- тебе нужно, чтобы и твои компоненты, и все Material‑компоненты внутри этой области жили в «локальной теме».

**Пример: «админская» панель с другой цветовой схемой и плотностью**

```scss
@use '@angular/material' as mat;

.admin-panel {
  @include mat.theme((
    color: (
      primary: mat.$azure-palette,
      tertiary: mat.$blue-palette,
    ),
    density: -2,
  ));
}
```

Теперь всё внутри `.admin-panel` (и Material‑компоненты, и твои собственные, если используют `--mat-sys-*`) будут использовать эту тему.

Когда НЕ надо тащить scoped‑тему:

- если меняется только один‑два компонента — лучше использовать их `*-overrides`;
- если нужно просто использовать цвета/отступы как у темы — достаточно системных CSS‑переменных без `mat.theme`.

## 4. Когда использовать CSS‑переменные Angular Material

Системные CSS‑переменные (`--mat-sys-*`) — основной способ стилизовать ТВОИ компоненты так, чтобы они выглядели «как часть Material‑темы» и автоматически поддерживали light/dark режимы.

Используй `--mat-sys-*`, когда:

- стилизуешь свои компоненты (не Material) — цвета, фоны, рамки, скругления, тени;
- хочешь, чтобы они следовали текущей теме и автоматически переключались между light/dark;
- не нужен полный scoped‑тема, а только заимствование отдельных решений.

**Пример: карточка фичи в стиле Material**

```css
.feature-card {
  background-color: var(--mat-sys-surface-container-low);
  color: var(--mat-sys-on-surface);
  border: 1px solid var(--mat-sys-outline-variant);
  border-radius: var(--mat-sys-corner-medium);
  box-shadow: var(--mat-sys-level2);
}

.feature-card h2 {
  color: var(--mat-sys-primary);
}
```

Использовать `--mat-sys-*` внутри `*-overrides` тоже можно и часто уместно, особенно для цветных токенов:

```scss
.my-button-row mat-button {
  @include mat.button-overrides((
    background-color: var(--mat-sys-secondary-container),
    color: var(--mat-sys-on-secondary-container),
  ));
}
```

Это делает настройки «тематичными» и привязанными к системе, а не к жёстким значениям.

## 5. Чего лучше НЕ делать

- Не лезть во внутренние DOM‑узлы и классы Material‑компонентов (`.mat-mdc-...`, внутренние элементы) — это private, при обновлении может сломаться.
- Не ставить стили на внутренние элементы через `::ng-deep` и глобальные CSS — крайний случай.
- Не менять через CSS свойства, которые Material сам использует для внутреннего лейаута (padding, height, width, overflow) на хосте компонента — это может сломать его поведение.

Вместо этого:

- свои стили — на своих классах;
- кастомизация Material‑компонентов — через `*-overrides` и, при необходимости, scoped‑темы;
- свои компоненты — через системные `--mat-sys-*` и/или тему.
# Техническое задание: Модальное окно с деталями табака

## Обзор

Необходимо реализовать модальное окно, которое отображает подробную информацию о табаке при клике на карточку табака в приложении. Это улучшит пользовательский опыт, позволяя пользователям быстро просматривать полную информацию о табаке без необходимости переходить на внешние ресурсы.

## Зачем это нужно

1. **Улучшение пользовательского опыта**: Пользователи смогут быстро просматривать полную информацию о табаке, не покидая приложение
2. **Увеличение вовлеченности**: Дополнительная информация (описание, крепость, статус) поможет пользователям принимать более информированные решения
3. **Снижение когнитивной нагрузки**: Вся необходимая информация доступна в одном месте, не нужно запоминать детали или возвращаться к списку
4. **Улучшение UX для мобильных устройств**: Модальное окно удобно работает на мобильных экранах Telegram Mini Apps

## Функциональные требования

### Триггер открытия модального окна

- Модальное окно открывается при клике в любом месте карточки табака
- Кнопка "Добавить/Удалить" на карточке продолжает работать независимо и не открывает модальное окно
- Модальное окно работает как на вкладке "Поиск", так и на вкладке "Wishlist"

### Отображаемая информация

В модальном окне отображаются следующие поля (в порядке сверху вниз):

1. **Изображение табака** - на всю ширину модального окна в верхней части
2. **Название табака** - заголовок с крупным шрифтом
3. **Бренд** - название бренда с указанием страны в формате "Бренд: [Название] ([Страна])"
4. **Линейка** - название линейки (только если поле lineId не null)
5. **Рейтинг** - в компактном формате "[Рейтинг] ([Количество оценок])" без иконки звезды
6. **Крепость официальная** - текстовое значение из поля strengthOfficial в формате "Крепость официальная: [Значение]"
7. **Крепость по оценкам** - текстовое значение из поля strengthByRatings в формате "Крепость по оценкам: [Значение]"
8. **Статус** - текстовое значение из поля status в формате "Статус: [Значение]"
9. **Описание** - полное текстовое описание с переносом слов, без обрезки

### Кнопка добавления/удаления из вишлиста

- В модальном окне есть кнопка добавления/удаления из вишлиста
- Кнопка занимает всю ширину модального окна и зафиксирована внизу
- Текст кнопки соответствует состоянию:
  - "Добавить" - если табак не в вишлисте
  - "Удалить" - если табак уже в вишлисте
- Состояние кнопки синхронизировано с карточкой табака
- При клике на кнопку отображается спиннер загрузки (как на карточках табака)
- Спиннер убирается только когда HTTP-запрос на добавление/удаление завершился (успешно или с ошибкой)
- При успешном добавлении/удалении модальное окно автоматически закрывается
- При ошибке добавления/удаления модальное окно остается открытым для возможности повторить действие

### Закрытие модального окна

- Модальное окно закрывается при клике на затемненный фон (backdrop)
- Нет отдельной кнопки закрытия (X)
- Закрытие по клавише ESC не требуется
- Автоматическое закрытие после успешного добавления/удаления из вишлиста

### Источник данных

- Все данные для отображения берутся из уже загруженного объекта TobaccoWithDetails
- Нет необходимости в дополнительных HTTP-запросах к API при открытии модального окна
- Нет состояния загрузки (spinner) для отображения данных - данные уже доступны
- Это обеспечивает мгновенное открытие модального окна
- Примечание: Спиннер отображается только на кнопке добавления/удаления во время выполнения HTTP-запроса, а не при загрузке данных для отображения

## Требования к дизайну и верстке

### Размер и позиционирование

- Модальное окно центрировано по горизонтали и вертикали
- Адаптивная ширина:
  - На мобильных устройствах: 90% ширины экрана
  - На десктопе: максимальная ширина 500px
- Высота определяется содержимым, но не превышает 80% высоты viewport
- Если содержимое не помещается, появляется вертикальная прокрутка

### Анимации

- Используются стандартные анимации Angular Material Dialog для открытия и закрытия
- Нет необходимости в кастомных анимациях

### Макет содержимого

- Изображение в верхней части на всю ширину модального окна
- Под изображением вертикальный список с деталями
- Кнопка добавления/удаления зафиксирована внизу

### Обработка ошибок

- Поскольку данные берутся из уже загруженного объекта, ситуация с отсутствием данных стремится к нулю и обрабатывать такие кейсы нет смысла.

## Нефункциональные требования

### Производительность

- Модальное окно должно открываться мгновенно (без задержек)
- Не должно быть дополнительных HTTP-запросов при открытии
- Использование существующих данных из карточки табака

### Доступность

- Модальное окно должно быть доступно для пользователей с ограниченными возможностями
- Достаточный контраст текста и фона
- Размеры шрифтов и отступы обеспечивают удобное чтение

### Совместимость

- Работает на всех поддерживаемых платформах (Telegram Mini Apps, веб-браузер)
- Корректно отображается на мобильных и десктопных устройствах
- Совместимо с существующей системой Material Design 3

## Технические ограничения

### Использование существующих данных

- Необходимо использовать объект TobaccoWithDetails, который уже содержит все необходимые данные
- Не создавать дополнительные типы данных или интерфейсы
- Не дублировать логику загрузки данных из API

### Интеграция с существующими компонентами

- Модальное окно должно быть отдельным компонентом
- Интеграция с SearchTab и WishlistTab через стандартные механизмы Angular (inputs/outputs)
- Не нарушать существующую логику работы с вишлистом

### Сохранение существующего поведения

- Кнопка "Добавить/Удалить" на карточке продолжает работать как раньше
- Существующие анимации и уведомления не должны измениться
- Не должно быть изменений в логике работы с вишлистом

## Приоритеты

### Критически важные функции

1. Открытие модального окна при клике на карточку
2. Отображение всех требуемых полей информации
3. Кнопка добавления/удаления в модальном окне
4. Закрытие модального окна по клику на backdrop

### Важные функции

5. Адаптивный дизайн для мобильных и десктопных устройств
6. Синхронизация состояния кнопки с карточкой
7. Автоматическое закрытие после добавления/удаления

## Критерии приемки

Функционал считается выполненным, когда:

1. При клике на карточку табака открывается модальное окно с полной информацией
2. Все требуемые поля отображаются корректно
3. Кнопка добавления/удаления работает и синхронизирована с карточкой
4. При клике на кнопку добавления/удаления отображается спиннер загрузки
5. Спиннер убирается только когда HTTP-запрос завершился (успешно или с ошибкой)
6. Модальное окно закрывается при клике на backdrop
7. Модальное окно автоматически закрывается только после успешного добавления/удаления
8. При ошибке добавления/удаления модальное окно остается открытым
9. Модальное окно корректно отображается на мобильных и десктопных устройствах
10. Не нарушается существующая функциональность приложения
11. Нет дополнительных HTTP-запросов при открытии модального окна
12. Приложение собирается без ошибок
13. Все тесты проходят успешно

## Риски и mitigation

### Риск: Данные TobaccoWithDetails могут быть неполными

**Mitigation**: Предусмотреть проверку на наличие всех требуемых полей и корректную обработку ситуации, когда данные отсутствуют

### Риск: Конфликт с существующей логикой работы с вишлистом

**Mitigation**: Тщательно протестировать интеграцию с SearchTab и WishlistTab, убедиться, что добавление/удаление работает корректно

### Риск: Проблемы с производительностью на мобильных устройствах

**Mitigation**: Использовать оптимизированные подходы Angular (OnPush change detection), избегать лишних перерисовок

### Риск: Проблемы с отображением на разных размерах экрана

**Mitigation**: Тщательно протестировать на различных устройствах и размерах экрана, использовать адаптивный дизайн

## Дополнительные замечания

- Модальное окно не должно заменять существующие функции просмотра деталей (например, переход на htreviews.org)
- Это дополнительный удобный способ просмотра информации внутри приложения
- В будущем можно рассмотреть добавление ссылки на htreviews.org в модальное окно, если это будет востребовано пользователями

# ==============================================================================
# Hookah Wishlist - Coolify Deployment Environment Variables
# ==============================================================================
# This file contains all environment variables required for production deployment
# on Coolify. Each variable is documented with its purpose, requirements, and
# security considerations.
#
# COOLIFY TOPOLOGY:
# - Only the 'mini-app' service is publicly accessible via Coolify routing
# - All internal services (api, bot, scraper, postgres) communicate via Docker
#   network using service names
# - Coolify handles SSL termination and domain routing for mini-app
#
# NETWORK ARCHITECTURE:
# - Frontend network: mini-app (publicly accessible via Coolify)
# - Backend network: api, bot, scraper, postgres (internal communication only)
# - Service names are used for inter-service communication (e.g., 'api', 'postgres')
#
# BUILD-TIME vs RUNTIME VARIABLES:
# - VITE_API_URL: Build-time variable (embedded during build, cannot be changed
#   at runtime without rebuilding)
# - All other variables: Runtime variables (can be changed without rebuild)
# ==============================================================================

# ==============================================================================
# TELEGRAM BOT CONFIGURATION
# ==============================================================================

# Telegram Bot Token
# Required: Yes
# Purpose: Authenticates the bot with Telegram's Bot API
# Impact: Without this, the bot cannot communicate with Telegram
# Security: CRITICAL - Never commit to version control or share publicly
# Format: String provided by @BotFather on Telegram
# Valid values: 40-50 character string starting with numbers
# Example: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_BOT_TOKEN=your_bot_token_here

# ==============================================================================
# BOT API KEY (INTERNAL AUTHENTICATION)
# ==============================================================================

# Bot API Key
# Required: Yes
# Purpose: Authenticates bot requests to the internal API service
# Impact: Without this, the bot cannot make authenticated API calls
# Security: CRITICAL - Must be a strong, random string. This is an internal
#          authentication mechanism between bot and API services.
# Format: Random alphanumeric string (recommended: 32+ characters)
# Valid values: Any secure random string
# Example: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
# Note: This is NOT a Telegram API key, but an internal service auth key
BOT_API_KEY=your_bot_api_key_here

# ==============================================================================
# DATABASE CONFIGURATION
# ==============================================================================

# PostgreSQL Database URL
# Required: Yes
# Purpose: Connection string for all services to connect to PostgreSQL
# Impact: Critical for all services that need database access (api, scraper)
# Security: Contains credentials - must be kept secret
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE
# Valid values: Valid PostgreSQL connection string
# Coolify Adaptation: MUST use 'postgres' as hostname (service name), NOT
#                    'localhost' or '127.0.0.1'
# Example: postgresql://hookah_user:hookah_password@postgres:5432/hookah_wishlist
# Services using this: api, scraper
DATABASE_URL=postgresql://hookah_user:hookah_password@postgres:5432/hookah_wishlist

# PostgreSQL User
# Required: Yes
# Purpose: Database user for PostgreSQL
# Impact: Used to create the database user during initialization
# Security: Contains database credentials - must be kept secret
# Format: Valid PostgreSQL username (alphanumeric, underscores)
# Valid values: String matching PostgreSQL username rules
# Services using this: postgres
POSTGRES_USER=hookah_user

# PostgreSQL Password
# Required: Yes
# Purpose: Database password for PostgreSQL user
# Impact: Used to authenticate database connections
# Security: CRITICAL - Must be a strong password. Never use default values
#          in production.
# Format: String (recommended: 16+ characters with mixed case, numbers, symbols)
# Valid values: Any secure password string
# Services using this: postgres
POSTGRES_PASSWORD=hookah_password

# PostgreSQL Database Name
# Required: Yes
# Purpose: Name of the PostgreSQL database
# Impact: All application data is stored in this database
# Security: Not sensitive, but should be consistent across environments
# Format: Valid PostgreSQL database name (alphanumeric, underscores)
# Valid values: String matching PostgreSQL database name rules
# Services using this: postgres
POSTGRES_DB=hookah_wishlist

# ==============================================================================
# ENVIRONMENT CONFIGURATION
# ==============================================================================

# Node Environment
# Required: Yes
# Purpose: Determines the runtime environment (development, production, test)
# Impact: Affects error handling, logging verbosity, and feature availability
# Security: Not sensitive, but should be set to 'production' for Coolify
# Format: String
# Valid values: 'development', 'production', 'test'
# Recommended: 'production' for Coolify deployment
NODE_ENV=production

# ==============================================================================
# LOGGING CONFIGURATION
# ==============================================================================

# Log Level
# Required: No (defaults to 'info')
# Purpose: Controls the verbosity of application logs
# Impact: Affects log volume and detail level
# Security: Not sensitive
# Format: String
# Valid values: 'error', 'warn', 'info', 'debug', 'trace'
# Recommended: 'info' for production, 'debug' for troubleshooting
# Services using this: api, bot, scraper
LOG_LEVEL=info

# ==============================================================================
# API CONFIGURATION
# ==============================================================================

# API URL (Internal Docker Network)
# Required: Yes
# Purpose: Base URL for internal API communication between services
# Impact: Used by bot service to communicate with API service
# Security: Not sensitive (internal network only)
# Format: URL with protocol and path
# Valid values: Valid HTTP URL
# Coolify Adaptation: MUST use 'api' as hostname (service name) and port 3000
#                    Format: http://api:3000/api/v1
#                    This is for INTERNAL Docker network communication only
# Services using this: bot
# Note: This is NOT the public API URL - mini-app uses VITE_API_URL instead
API_URL=http://api:3000/api/v1

# ==============================================================================
# MINI-APP CONFIGURATION (BUILD-TIME VARIABLE)
# ==============================================================================

# Vite API URL (Public Coolify Domain)
# Required: Yes
# Purpose: Base URL for mini-app to communicate with API from user's browser
# Impact: Critical for mini-app functionality - users cannot access the API
#         without this being correctly configured
# Security: Not sensitive (public endpoint)
# Format: URL with protocol and path
# Valid values: Valid HTTPS URL (must use HTTPS in production)
# Coolify Adaptation: MUST be the PUBLIC Coolify domain, NOT the internal
#                    service name. This is accessed from users' browsers,
#                    not from within the Docker network.
# Example: https://hookah-wishlist.your-coolify-domain.com/api/v1
# Build-time: This variable is embedded during the build process and CANNOT
#             be changed at runtime without rebuilding the mini-app container
# Services using this: mini-app (build-time arg)
# Note: When deploying to Coolify, replace with your actual Coolify domain
VITE_API_URL=https://your-coolify-domain.com/api/v1

# ==============================================================================
# SCRAPER CONFIGURATION
# ==============================================================================

# Scraper Schedule (Cron Expression)
# Required: No (defaults to "0 2 * * *" - 2 AM daily)
# Purpose: Defines when the scraper runs to update tobacco/brand data
# Impact: Determines how fresh the data remains
# Security: Not sensitive
# Format: Cron expression (minute hour day month weekday)
# Valid values: Valid cron expression
# Examples:
#   "0 2 * * *" - Daily at 2 AM
#   "0 */6 * * *" - Every 6 hours
#   "0 0 * * 0" - Weekly on Sunday at midnight
# Services using this: scraper
SCRAPER_SCHEDULE="0 2 * * *"

# Scraper Timeout (milliseconds)
# Required: No (defaults to 60000)
# Purpose: Maximum time to wait for a single HTTP request during scraping
# Impact: Prevents scraper from hanging on slow/unresponsive sites
# Security: Not sensitive
# Format: Integer (milliseconds)
# Valid values: 1000-300000 (1 second to 5 minutes)
# Recommended: 60000 (60 seconds) for most sites
# Services using this: scraper
SCRAPER_TIMEOUT=60000

# Scraper Max Retries
# Required: No (defaults to 3)
# Purpose: Maximum number of retry attempts for failed HTTP requests
# Impact: Affects resilience vs. total scraping time
# Security: Not sensitive
# Format: Integer
# Valid values: 1-10
# Recommended: 3 for production
# Services using this: scraper
SCRAPER_MAX_RETRIES=3

# Scraper Delay Between Brand Requests (milliseconds)
# Required: No (defaults to 2000)
# Purpose: Delay between scraping different brands to be polite to the server
# Impact: Affects total scraping time and server load
# Security: Not sensitive
# Format: Integer (milliseconds)
# Valid values: 500-10000
# Recommended: 2000 (2 seconds) to avoid rate limiting
# Services using this: scraper
SCRAPER_DELAY_BRAND=2000

# Scraper Delay Between Tobacco Requests (milliseconds)
# Required: No (defaults to 1000)
# Purpose: Delay between scraping different tobacco products to be polite
# Impact: Affects total scraping time and server load
# Security: Not sensitive
# Format: Integer (milliseconds)
# Valid values: 200-5000
# Recommended: 1000 (1 second) to avoid rate limiting
# Services using this: scraper
SCRAPER_DELAY_TOBACCO=1000

# ==============================================================================
# JWT AUTHENTICATION CONFIGURATION
# ==============================================================================

# JWT Secret Key
# Required: Yes
# Purpose: Secret key used to sign and verify JWT tokens for user authentication
# Impact: CRITICAL - If compromised, attackers can forge tokens and impersonate
#         any user. All user sessions would be vulnerable.
# Security: CRITICAL - Must be a strong, random string (minimum 32 characters).
#          Never use default values in production. Rotate periodically.
# Format: Random alphanumeric string
# Valid values: Any secure random string (recommended: 64+ characters)
# Example: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
# Services using this: api
JWT_SECRET=your_jwt_secret_key_here

# JWT Expiration Time
# Required: No (defaults to "7d")
# Purpose: How long JWT tokens remain valid before requiring re-authentication
# Impact: Affects user experience and security. Shorter = more secure but more
#         frequent logins. Longer = better UX but higher risk if token is stolen.
# Security: Not sensitive, but affects security posture
# Format: String with number and unit
# Valid values: Number followed by unit (s=seconds, m=minutes, h=hours, d=days)
# Examples:
#   "1h" - 1 hour (high security, frequent re-auth)
#   "24h" - 1 day (balanced)
#   "7d" - 7 days (good UX, moderate security)
#   "30d" - 30 days (best UX, lower security)
# Recommended: "7d" for production
# Services using this: api
JWT_EXPIRES_IN=7d

# ==============================================================================
# ADDITIONAL CONFIGURATION NOTES
# ==============================================================================

# COOLIFY DEPLOYMENT CHECKLIST:
# 1. Set NODE_ENV=production
# 2. Replace TELEGRAM_BOT_TOKEN with actual token from @BotFather
# 3. Generate strong random values for:
#    - BOT_API_KEY (32+ characters)
#    - POSTGRES_PASSWORD (16+ characters)
#    - JWT_SECRET (64+ characters)
# 4. Set VITE_API_URL to your actual Coolify domain (HTTPS)
# 5. Verify DATABASE_URL uses 'postgres' as hostname (service name)
# 6. Verify API_URL uses 'api:3000' for internal communication
# 7. Adjust scraper schedule and delays based on your needs
# 8. Set LOG_LEVEL to 'info' for production (or 'debug' for troubleshooting)

# SECURITY BEST PRACTICES:
# - Never commit this file with actual values to version control
# - Use Coolify's environment variable management to set these values
# - Rotate secrets periodically (especially JWT_SECRET and BOT_API_KEY)
# - Use strong, unique passwords for all services
# - Enable HTTPS for the public Coolify domain (VITE_API_URL)
# - Monitor logs for authentication failures and suspicious activity
# - Restrict database access to the internal network only

# TROUBLESHOOTING:
# - If bot cannot connect to API: Verify API_URL uses 'api:3000'
# - If mini-app cannot connect to API: Verify VITE_API_URL is your public domain
# - If database connection fails: Verify DATABASE_URL uses 'postgres' hostname
# - If scraper fails: Check timeouts, retries, and delays
# - If authentication fails: Verify BOT_API_KEY and JWT_SECRET match across services

# SERVICE COMMUNICATION FLOW:
# User Browser -> Coolify Domain -> mini-app (VITE_API_URL)
# mini-app -> Coolify Domain -> API (via public routing)
# bot -> api:3000 (internal Docker network)
# api -> postgres:5432 (internal Docker network)
# scraper -> postgres:5432 (internal Docker network)

# NETWORK TOPOLOGY SUMMARY:
# - Public Access: Only mini-app via Coolify domain
# - Internal Communication: All other services via Docker network service names
# - Service Names: api, bot, scraper, postgres
# - Networks: frontend (mini-app), backend (api, bot, scraper, postgres)
